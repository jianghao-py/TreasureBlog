### 闭包

**为什么使用？**

<br>

<br>

### 一个场景

```javascript
let num = 0;

function add(){
    // 问题一：如果在函数内初始化起始值，会导致每次调用都会重置为0
    //let num = 0;
    num++; 
    console.log(num);
}

add(); //1
add(); //2
add(); //3

// 问题二：函数使用全局作用域的初始值，会产生全局作用域值重新定义的问题（假设团队中某个成员改变了这个值，函数就受影响）
num = 10;
add(); //11
```

<br>

<br>

### 使用嵌套函数解决问题

<br>

- 这个解决方案（```inner()```）就是闭包
- 闭包就是 ```inner()``` 函数
- **闭包的定义：** 指有权访问另一个函数作用域中的变量的函数，一般情况就是在一个函数中包含另一个函数
- **闭包的作用：** 访问函数内部变量、保持函数在环境中一直存在，不会被垃圾回收机制处理
- 此时 ```num``` 就无法被外部访问

```javascript
function add(){
    let num = 0;

    function inner(){
        num++;
        console.log(num);
    }

    return inner;
}

let fn = add();
fn();
```

<br>

<br>

### 闭包的产生条件

1. 闭包必须有函数的嵌套
2. 内部函数必须要访问外部函数的变量
3. 必须将内部函数作为返回值返回

<br>

<br>

### 闭包的生命周期

- 当外部函数被调用时，闭包就产生了
- 外部函数**每被调用一次**，就产生一个闭包
- 当内部函数被**垃圾回收**时，闭包就消失了

<br>

```javascript
function add(){
    let num = 0;

    function inner(){
        num++;
        console.log(num);
    }

    return inner;
}

let fn = add();
fn = null; //此时闭包销毁
```